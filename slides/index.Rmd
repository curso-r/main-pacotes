---
title: "Pacotes üì¶"
author: "<img src = 'https://d33wubrfki0l68.cloudfront.net/9b0699f18268059bdd2e5c21538a29eade7cbd2b/67e5c/img/logo/cursor1-5.png' width = '20%'>"
date: ""
output:
  xaringan::moon_reader:
    css: ["default", "default-fonts", "css/custom-intro.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r, child="00-preamble.Rmd"}

```


# Sum√°rio

1. [Sobre a Curso-R](#sobre-curso-r)

1. [Sobre o curso](#sobre-o-curso)

1. [Preparando o ambiente de desenvolvimento](#preparando-o-ambiente)

1. [Fundamentos de desenvolvimento de pacotes em R](#fundamentos-pacote)

1. [Documenta√ß√£o](#documentacao)

1. [Testes unit√°rios e consist√™ncia de c√≥digo](#testes-unitarios)

1. [Disponibilizando seu pacote](#disponibilizando-o-pacote)

---
class: middle, center
name: sobre-curso-r

# Sobre a Curso-R

---

class: middle, center

## A empresa

.pull-left[
```{r, echo = FALSE}
knitr::include_graphics("https://d33wubrfki0l68.cloudfront.net/295643c6243701ae6a9bac3fb8ad467ff0ce3c84/d1785/img/logo/cursor1-41.png")
```

<br>
<br>

```{r, echo = FALSE}
knitr::include_graphics("img/logo_r6.png")
```

]

.pull-right[
```{r, echo = FALSE, out.width="90%"}
knitr::include_graphics("img/produtos.png")
```
]

**[www.curso-r.com](https://www.curso-r.com)**

---

## Ministrantes

.pull-left[

### Caio Lente

```{r, echo=FALSE, out.width="30%"}
knitr::include_graphics("img/caio.jpeg")
```

Mestrando em Ci√™ncia da Computa√ß√£o no IME-USP e cientista de dados na Terranova Consultoria. Programador desde os 15 anos, come√ßou a se apaixonar pelo R em 2016 e agora n√£o fala em outra coisa. Metido a designer, man√≠aco da organiza√ß√£o e metade texano.

]


.pull-right[

### Beatriz Milz

```{r, echo=FALSE, out.width="30%"}
knitr::include_graphics("img/bea.jpg")
```

Doutoranda em Ci√™ncia Ambiental (PROCAM/IEE/USP) na Universidade de S√£o Paulo. Co-organizadora da [R-Ladies S√£o Paulo](https://www.meetup.com/R-Ladies-Sao-Paulo/). Instrutora da [Carpentries](https://carpentries.org/instructors/), um projeto que tem como miss√£o ensinar habilidades de ci√™ncia de dados para pessoas pesquisadoras. Instrutora de tidyverse [certificada pela RStudio](https://education.rstudio.com/trainers/people/milz+beatriz/). 



]

---

## Linha do tempo



```{r, echo=FALSE, out.width="40%"}
knitr::include_graphics("img/linha_do_tempo.png")
```


---

## Nossos cursos


.pull-left[
<div class="container center">
  <div class="card">
    <h2>Programa√ß√£o em R</h2>
    <hr style = "background-color: #3bb44a;"/>
    <p><a href = "https://www.curso-r.com/cursos/intro-programacao/">Introdu√ß√£o √† programa√ß√£o com R</a></p>
    <p><a href = "https://www.curso-r.com/cursos/r4ds-1/">R para Ci√™ncia de dados I</a></p>
    <p><a href = "https://www.curso-r.com/cursos/r4ds-2/">R para Ci√™ncia de dados II</a></p>
    <p><a href = "https://www.curso-r.com/cursos/pacotes/">Pacotes</a></p>
    <p><a href = "https://www.curso-r.com/cursos/rcpp/">Introdu√ß√£o ao R com C++</a></p>

  </div>
</div>

<br>

<div class="container center">
  <div class="card">
    <h2>Extra√ß√£o de dados</h2>
    <hr style = "background-color: #eeba30;"/>
    <p><a href = "https://www.curso-r.com/cursos/faxina/">Faxina de dados</a></p>
    <p><a href = "https://www.curso-r.com/cursos/web-scraping/">Web scraping</a></p>

  </div>
</div>
]


.pull-right[
<div class="container center">
  <div class="card">
    <h2>Modelagem</h2>
    <hr style = "background-color: #996699;"/>
    <p><a href = "https://www.curso-r.com/cursos/regressao-linear/">Regress√£o Linear</a></p>
    <p><a href = "https://www.curso-r.com/cursos/intro-machine-learning/">Machine Learning</a></p>
    <p><a href = "https://www.curso-r.com/cursos/xgboost/">XGBoost</a></p>
    <p><a href = "https://www.curso-r.com/cursos/deep-learning/">Deep Learning</a></p>
  </div>
</div>

<br><br> 

<div class="container center">
  <div class="card">
    <h2>Comunica√ß√£o e automa√ß√£o</h2>
    <hr style = "background-color: #ff6699;"/>
    <p><a href = "https://www.curso-r.com/cursos/dashboards/">Relat√≥rios e visualiza√ß√£o de dados</a></p>
    <p><a href = "https://www.curso-r.com/cursos/dashboards/">Dashboards com R</a></p>
    <p><a href = "https://www.curso-r.com/cursos/deploy/">Deploy</a></p>
  </div>
</div>
]


---
class: middle, center
name: sobre-o-curso

# Sobre o curso

---
## Nesse curso vamos falar de... üì¶


- **Fundamentos de desenvolvimento de pacotes em R**


- **Documenta√ß√£o**


- **Testes unit√°rios e consist√™ncia de c√≥digo**



- **Disponibilizando seu pacote**

<!-- Acho bem legal o Zenodo, mas acho que n√£o cabe no tempo. Quem sabe na pr√≥xima :) -->



---

## Informa√ß√µes gerais

- As aulas v√£o das 9h √†s 13, com uma pausa de 10 min em torno das 11:00
- As aulas ser√£o gravadas e disponibilizadas no Google Classroom
- Podem mandar d√∫vidas no chat do Zoom ou abrir o microfone para perguntar
- Teremos bastante exerc√≠cios para resolver durante o workshop, ent√£o se prepare!

## Informa√ß√µes de voc√™s

- N√≥s gostar√≠amos de saber sobre voc√™s:

  - Nome
  - Com o que trabalha?
  - Como imagina usar pacotes no futuro?


---

## Tirando d√∫vidas

- **N√£o existe d√∫vida idiota**.
 
 
- Fora do hor√°rio do workshop:
  - perguntas gerais sobre o workshop dever√£o ser feitas no Classroom.
  - perguntas sobre R, principalmente as que envolverem c√≥digo, dever√£o ser enviadas no [nosso discourse](https://discourse.curso-r.com/).

- [Veja aqui dicas de como fazer uma boa pergunta](https://discourse.curso-r.com/t/como-escrever-uma-boa-pergunta/542).

---
## Por que usar o discourse?

- Muito melhor para escrever textos que possuem c√≥digos. Com ele, podemos usar o pacote `{reprex}`!

- Saber pesquisar sobre erros e fazer a pergunta certa √© essencial para aprender e resolver problemas de programa√ß√£o.

- No discourse, teremos mais pessoas acompanhando e respondendo as d√∫vidas.

- Em um ambiente aberto, as suas d√∫vidas v√£o contribuir com a comunidade.

**https://discourse.curso-r.com/**

---
class: middle, center, inverse
name: preparando-o-ambiente
# Preparando o ambiente de desenvolvimento !

---
## Check-list antes de come√ßar a aula

- [R instalado](https://livro.curso-r.com/1-1-instalacao-do-r.html) ‚úÖ

- [RStudio instalado](https://livro.curso-r.com/1-1-instalacao-do-r.html) ‚úÖ

- [Pacotes necess√°rios instalados](https://github.com/curso-r/main-pacotes#pacotes-necess%C3%A1rios)  ‚úÖ

- [Git instalado](https://git-scm.com/) ‚úÖ

- [Conta no GitHub criada](https://github.com/)  ‚úÖ


---
class: middle, center, inverse
## .RData e .Rhistory

---
### Os arquivos .RData e .Rhistory 

Em sua configura√ß√£o padr√£o, a IDE manter√° na "mem√≥ria" todos os √∫ltimos comandos executados, todos os dados utilizados e todos os objetos criados. 

Ao fechar e abrir o RStudio, essas informa√ß√µes ser√£o recarregadas na mem√≥ria como se o usu√°rio nunca tivesse sa√≠do do programa. Esse recurso √© tornado poss√≠vel pela cria√ß√£o de dois arquivos ocultos: `.RData` e `.Rhistory`.

O primeiro abriga absolutamente todos os objetos criados por uma sess√£o R, enquanto o segundo cont√©m uma lista com os √∫ltimos comandos executados. 

Ao reabrir o RStudio, o conte√∫do armazenados nestes arquivos ser√° carregado no ambiente de trabalho atual como se nada tivesse acontecido.

.footnote[Leia mais [neste cap√≠tulo do livro Zen do R](https://curso-r.github.io/zen-do-r/rdata-rhistory.html).]
---
### Por que desistir do .RData e .Rhistory 

- Se todos os resultados parciais de uma an√°lise estiverem dispon√≠veis a qualquer momento, `r colorido("diminui o incentivo para a escrita de c√≥digo reprodut√≠vel")`.

- Se todo o hist√≥rico de comandos for acess√≠vel, `r colorido("acaba a necessidade de experimentos controlados")`.

- Ao dependermos ativamente do `.Rdata`, `r colorido("se acidentalmente sobrescrevemos um objeto")` relevante e o c√≥digo para recri√°-lo n√£o estiver mais acess√≠vel, `r colorido("n√£o haver√° nenhuma forma confi√°vel de recuper√°-lo")`.

- A menos que pretendamos sentar com colegas para explicar como utilizar os objetos do `.RData` e do `.Rhistory`, `r colorido("n√£o pode-se esperar que outra pessoa seja capaz de reproduzir uma an√°lise")`.

- O R trata todos os objetos guardados na mem√≥ria igualmente. Isso significa que ele tamb√©m ir√° armazenar nos arquivos ocultos todas as bases de dados da sess√£o. Assim, `r colorido("o")` `.RData` `r colorido("pode ser um arquivo de m√∫ltiplos gigabytes")`.


---
class: middle, center
name: fundamentos-pacote

# Fundamentos de desenvolvimento de pacotes em R

---
class: middle, center, inverse
# Pacotes

---
## Pacotes

Um pacote do R nada mais √© do que uma forma espec√≠fica de organizar seus c√≥digo, seguindo o protocolo descrito pela R Foundation.

> Pacotes s√£o a unidade fundamental de c√≥digo R reprodut√≠vel. <br>
> Hadley Wickham

.pull-left[
- Pacotes incluem: 
  - Fun√ß√µes em R
  - Documenta√ß√£o sobre como us√°-las
  - Testes
  - Dados de exemplo
]

.pull-right[
```{r echo=FALSE, fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/pacote.gif")
```
]

---
## Vantagens

- Padroniza a organiza√ß√£o dos c√≥digos

- Integra√ß√£o com pacotes que aceleram desenvolvimento

- Motiva e facilita a documenta√ß√£o do c√≥digo

- Facilita o compartilhamento e a reutiliza√ß√£o de c√≥digos em outros projetos e com outras pessoas

> Anything that can be automated, should be automated

> Tradu√ß√£o: Qualquer coisa que possa ser automatizada, deve ser automatizada.

> Fonte: [Wickham & Bryan - Livro R Packages](https://r-pkgs.org/intro.html)

---
## Simplificando tudo: usethis

O pacote `{usethis}` ajuda com todo o fluxo de desenvolvimento em R.

Ele ajuda a criar arquivos, projetos, usar o Git, criar reposit√≥rios no GitHub e muito mais.

```{r echo=FALSE, out.width="15%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/usethis.png")
```

Apresentaremos v√°rias fun√ß√µes do `{usethis}` ao longo deste t√≥pico.


---
## Criando um pacote

Para criar um pacote, usamos a fun√ß√£o `usethis::create_package()`.

Tenha em mente que:

- Voc√™ deve passar um caminho como `~/Documents/MeuProjeto` e uma nova pasta chamada "Meu projeto" na pasta ser√° criada dentro da pasta `Documents`. Essa pasta ser√° tanto um `Rproj` quanto um pacote, ambos chamados `MeuProjeto`.

- Nomes de pacotes s√≥ podem conter letras, n√∫meros e pontos, devem come√ßar com uma letra e n√£o podem acabar com um ponto.

- **Dica geral:** n√£o adicione acentos, caracteres especiais e espa√ßos no nome dos caminhos, arquivos, fun√ß√µes, pacotes, etc.

---

```r
usethis::create_package("~/Documents/Meuprojeto")
# ‚úì Creating '/Users/beatrizmilz/Documents/Meuprojeto/'
# ‚úì Setting active project to '/Users/beatrizmilz/Documents/Meuprojeto'
# ‚úì Creating 'R/'
# ‚úì Writing 'DESCRIPTION'
# Package: Meuprojeto
# Title: What the Package Does (One Line, Title Case)
# Version: 0.0.0.9000
# Authors@R (parsed):
#     * First Last <first.last@example.com> [aut, cre] (YOUR-ORCID-ID)
# Description: What the package does (one paragraph).
# License: `use_mit_license()`, `use_gpl3_license()` or friends to
#     pick a license
# Encoding: UTF-8
# LazyData: true
# Roxygen: list(markdown = TRUE)
# RoxygenNote: 7.1.1
# ‚úì Writing 'NAMESPACE'
# ‚úì Writing 'Meuprojeto.Rproj'
# ‚úì Adding '^Meuprojeto\\.Rproj$' to '.Rbuildignore'
# ‚úì Adding '.Rproj.user' to '.gitignore'
# ‚úì Adding '^\\.Rproj\\.user$' to '.Rbuildignore'
# ‚úì Opening '/Users/beatrizmilz/Documents/Meuprojeto/' in new RStudio session
# ‚úì Setting active project to '<no active project>'
```


---
## Diret√≥rio de trabalho

O arquivo `NomeDoPacote.Rproj` indica para o RStudio que aquele diret√≥rio ser√° a raiz de um projeto e que, sempre que o projeto estiver aberto, ser√° utilizado por padr√£o como o diret√≥rio de trabalho.

Fixar o diret√≥rio de trabalho como a pasta raiz do projeto, ao lado da regra de manter todos os arquivos dentro da pasta do projeto, garante que sua an√°lise poder√° ser executada por qualquer pessoa e em qualquer computador sem a preocupa√ß√£o de ajustar caminhos at√© os arquivos utilizados ou criados pelo seu c√≥digo.

---

## Estrutura b√°sica do pacote

Essa √© a estrutura criada quando usamos a fun√ß√£o `usethis::create_package()`:

- `MeuProjeto.Rproj`: este arquivo faz com que este diret√≥rio seja um projeto no RStudio (RStudio Project).

- `DESCRIPTION`: define o nome, descri√ß√£o, vers√£o, licen√ßa, depend√™ncias e outras caracater√≠sticas do seu pacote.

- `R/`: aqui ficam as fun√ß√µes desenvolvidas em R.

- `LICENSE`: especifica os termos de uso e distribui√ß√£o do seu pacote.

- `.Rbuildignore`: .revisar[Lista arquivos  que s√£o necess√°rios ter no diret√≥rio, mas que n√£o devem ser inclu√≠dos ao compilar o pacote R a partir do c√≥digo-fonte.]

- `NAMESPACE`: .revisar[N√£o devemos editar este arquivo manualmente. O NAMESPACE declara: 
  - as fun√ß√µes que o pacote exporta para uso externo; 
  - e as fun√ß√µes externas que seu pacote importa de outros pacotes.]

---

## Estrutura do pacote: outros diret√≥rios e arquivos

.fazer[Acho legal falar de outros tipos diretorios mais comuns, como o inst/]

- `.gitignore`: Lista arquivos que dever√£o ser ignorados ao versionar o pacote com Git. 

.ideias[Cuidado aqui. Verificar se explicamos o que √© git antes.]

---

.fazer[Acho legal falar sobre como adicionar uma licen√ßa no pacote. `usethis::use_mit_license("Seu nome aqui")]

---

.fazer[slide sobre o ciclo que o hadley mostra nas palestras: editar, load all, check]


---

.revisar[

## Ideia da primeira parte pr√°tica

- Criar um pacote

- Observar a estrutura do diret√≥rio

- `devtools::load_all()` +  `devtools::check()` 

<!-- vai aparecer um warning de que precisa criar uma licen√ßa -->

- Adicionar uma licen√ßa no pacote

- Alterar o description: nome da pessoa autora, descri√ß√£o do pacote.
]


---
class: middle, center, inverse

# Fun√ß√µes

---
## A pasta R

Dentro de um pacote, a pasta `R/` s√≥ pode ter fun√ß√µes.

Uma fun√ß√£o √© respons√°vel por executar uma tarefa pequena, mas muito bem. Quando trabalhamos com fun√ß√µes, nossas opera√ß√µes ficam mais confi√°veis.

A ideia da pasta `R/` √© guardar em um local comum tudo aquilo que n√≥s utilizamos como ferramenta interna para nossas an√°lises, bem como aquilo que queremos que outras pessoas possam usar no futuro.


---
## Fun√ß√µes

Quando uma tarefa de an√°lise de dados aumenta em complexidade, o n√∫mero de fun√ß√µes e arquivos necess√°rios para manter tudo em ordem cresce exponencialmente. 

Um arquivo para ler os dados, outro para limpar os nomes das colunas, mais um para fazer joins‚Ä¶ Cada um deles com incont√°veis blocos de c√≥digo que rapidamente se transformam em uma [macarronada](https://pt.wikipedia.org/wiki/C%C3%B3digo_espaguete).

`r colorido("O primeiro passo para sair dessa situa√ß√£o √© transformar tudo em fun√ß√µes")`.

Fun√ß√µes t√™m argumentos e sa√≠das, enquanto c√≥digo solto pode modificar globais e criar resultados tardios que s√£o imposs√≠veis de acompanhar sem conhecer profundamente a tarefa sendo realizada.

No mundo ideal, na pasta `R/` do seu projeto haver√° uma cole√ß√£o de arquivos, cada um com uma cole√ß√£o de fun√ß√µes relacionadas e bem documentadas, e apenas alguns arquivos que utilizam essas fun√ß√µes para realizar a an√°lise em si. 

---
## Vantagens de usar fun√ß√µes

- Um c√≥digo bem encapsulado reduz a necessidade de objetos intermedi√°rios ( `base_tratada`, `base_filtrada` etc.) pois para gerar um deles basta a aplica√ß√£o de uma fun√ß√£o.

- Programas com fun√ß√µes normalmente s√£o muito mais enxutos e limpos do que *scripts* soltos, pois estes estimulam repeti√ß√£o de c√≥digo. 

- Ao encontrar um bug, haver√° apenas um lugar para concertar; se surgir a necessidade de modificar uma propriedade, haver√° apenas um lugar para editar; se aquele c√≥digo se tornar obsoleto, haver√° apenas um lugar para deletar.

.footnote[Leia mais [neste cap√≠tulo do livro R for Data Science](https://r4ds.had.co.nz/functions.html).]


---

## Fun√ß√µes

- Fun√ß√µes no R s√£o *nomes* que guardam um **c√≥digo de R**. A ideia √© a seguinte: sempre que voc√™ executar uma fun√ß√£o, o c√≥digo que ela guarda ser√° executado e um resultado nos ser√° devolvido.


.fazer[falar sobre o usethis::use_r()]

---

### Argumentos de fun√ß√µes

As fun√ß√µes podem receber **argumentos**. Argumentos s√£o os valores que colocamos dentro dos par√™nteses e que as fun√ß√µes precisam para funcionar (calcular algum resultado). 



Os argumentos das fun√ß√µes tamb√©m t√™m nomes, que podemos ou n√£o usar na hora de usar uma fun√ß√£o. Veja por exemplo a fun√ß√£o `seq()`. 

```{r}
seq(from = 4, to = 10, by = 2)
```

Entre outros argumentos, ela possui os argumentos `from=`, `to=` e `by=`. O que ela faz √© criar uma sequ√™ncia (vetor) de `by` em `by` que come√ßa em `from` e termina em `to`. No exemplo, criamos uma fun√ß√£o de 2 em 2 que come√ßa em 4 e termina em 10.

---
## Criando a sua pr√≥pria fun√ß√£o

Quando estamos desenvolvendo pacotes, iremos criar fun√ß√µes para executar as tarefas necess√°rias.

A sintaxe √© a seguinte:

```{r}
nome_da_funcao <- function(argumento_1, argumento_2) {
  
  # C√≥digo que a fun√ß√£o ir√° executar
  
}
```

Repare que `function` √© um nome reservado no R, isto √©, voc√™ n√£o pode criar um objeto com esse nome.

---

Um exemplo: vamos criar uma fun√ß√£o que soma dois n√∫meros.

```{r}
minha_soma <- function(x, y) {
  soma <- x + y
  
  soma  # resultado retornado
}
```

Essa fun√ß√£o tem os seguintes componentes:

- `minha_soma`: nome da fun√ß√£o
- `x` e `y`: argumentos da fun√ß√£o
- `soma <- x + y`: opera√ß√£o que a fun√ß√£o executa
- `soma`: valor retornado pela fun√ß√£o


---
## Depend√™ncias

Sem os in√∫meros pacotes criados pela comunidade, o R provavelmente j√° estaria no por√£o da Ci√™ncia de Dados. 

Por isso, √© a primeira coisa que escrevemos nos nossos *scripts* quase sempre √© `library(algumPacoteLegal)`.


### Quatro pontos

Quando lidamos com pacotes, a fun√ß√£o `library()` n√£o √© utilizada, e todas as fun√ß√µes devem ter seus pacotes de origem explicitamente referenciados pelo operador `::`.


**Existem vantagens de se fazer isso**. E, se serve como consolo, **o RStudio facilita muito esse tipo de programa√ß√£o** por causa da sua capacidade de sugerir continua√ß√µes para c√≥digo interativamente. 

Para escrever `dplyr::`, por exemplo, basta digitar `d`, `p`, `l` e apertar TAB uma vez. Com os `::`, as sugest√µes passar√£o a ser somente de fun√ß√µes daquele pacote.

---
## Vatangens dos quatro pontos

- O c√≥digo, no total, executa um pouco mais r√°pido porque s√£o carregadas menos fun√ß√µes no ambiente global (isso √© especialmente importante em aplica√ß√µes interativas feitas em Shiny).

- As depend√™ncias do c√≥digo est√£o sempre atualizadas porque elas est√£o diretamente atreladas √†s pr√≥prias fun√ß√µes sendo utilizadas.

- O uso do `::` √© fundamental na cria√ß√£o e organiza√ß√£o de pacotes.

---

.fazer[falar sobre o usethis::use_package(), usethis::use_dev_package() e usethis::use_pipe()]


---
class: middle, center, inverse
# Bases de dados


---
## Dados

Se voc√™ quiser inserir dados ao seu pacote, voc√™ pode utilizar a fun√ß√£o `usethis::use_data(meus_dados)`. 

Ela criar√° uma pasta `data/` na raiz do seu pacote, caso ela n√£o exista ainda, e salvar√° nela o objeto `meus_dados` em formato `.rda`.

Arquivos `.rda` s√£o extremamente est√°veis, compactos e podem ser carregados rapidamente pelo R, tornando este formato o principal meio de guardar dados de um pacote.

---
## Manipulando dados crus

Se a base que voc√™ quiser colocar no pacote for o resultado de um processo de manipula√ß√£o de uma base crua, voc√™ pode salvar o c√≥digo desse processo na pasta `data-raw`. 

Para isso, utilize a fun√ß√£o `usethis::use_data_raw("meus_dados")`. Ela criar√° uma pasta `data-raw/` na raiz do seu pacote, caso ela n√£o exista ainda, e um arquivo `meus_dados.R` onde voc√™ colocar√° o c√≥digo de manipula√ß√£o da base crua.

---
## Qual a diferen√ßa entre R/ e data-raw/?

`data-raw`

- A pasta `data-raw/` √© sua caixa de areia.

- Apesar de existirem formas razo√°veis de organizar seus pacotes aqui, nessa parte voc√™ ser√° livre.

`R/`

- J√° a pasta `R/` conter√° fun√ß√µes bem organizadas e documentadas.

- Por exemplo, uma fun√ß√£o que ajusta um modelo estat√≠stico, outra que arruma um texto de um jeito patronizado, ou uma que cont√©m seu tema customizado do `ggplot`.

- Dentro dessa pasta voc√™ n√£o deve carregar outros pacotes com `library()`, mas sim usar o operador `::`.


---

## Resumo dos passos iniciais

<!-- anotacoes da leitura do rpkgs -->

- Criamos um pacote usando a fun√ß√£o `usethis::create_package("~/caminho/ate/o/pacote")`

- No arquivo DESCRIPTION, adicionamos o nome das pessoas autoras, al√©m do t√≠tulo e descri√ß√£o do pacote.

- Adicionar uma licen√ßa

- Versionamos o projeto usando `usethis::use_git()`

- Crie suas fun√ß√µes: a fun√ßao `usethis::use_r("nome_da_funcao")` cria o arquivo para isso

- A func√£o `devtools::load_all()` simula o processo de instala√ß√£o e carregamento do pacote. As fun√ß√µes criadas ficam dispon√≠veis para uso. Atalho:  Ctrl + Shift + L (Windows e Linux) ou Cmd + Shift + L (macOS).

- A fun√ß√£o `devtools::check()` verifica se o pacote est√° funcionando. Pode apresentar erros, avisos e notas. Leia a mensagem no console :)

---
class: middle, center
name: documentacao

# Documenta√ß√£o


---
## Documenta√ß√£o

A documenta√ß√£o de fun√ß√µes deve seguir a estrutura a seguir usando o s√≠mbolo `#'`:

```{r eval=FALSE}
#' T√≠tulo da fun√ß√£o
#'
#' Descri√ß√£o da fun√ß√£o
#' 
#' @param a primeiro par√¢metro
#' @param b segundo par√¢metro
#' 
#' @return descri√ß√£o do resultado
#' 
#' @export
fun <- function(a, b) { 
  a + b
}
```

O par√¢metro `@export` indica que a fun√ß√£o ficar√° dispon√≠vel quando rodarmos `library(MeuProjeto)`.

.fazer[falar sobre o atalho do roxygen]

- Para deixar a documenta√ß√£o das suas fun√ß√µes acess√≠vel (no help do R), use a fun√ß√£o `devtools::document()`. Atalhos: Ctrl + Shift + D (Windows e Linux) ou Cmd + Shift + D (macOS).

---
.fazer[falar sobre documenta√ß√£o de fun√ß√µes]

.fazer[falar sobre documenta√ß√£o de base de dados]

.fazer[Acentos, encoding e vari√°veis globais]



---
## Comunica√ß√£o

Se voc√™ precisar construir sites, relat√≥rios, dashboards est√°ticos (flexdashboard) dentro do seu pacote, voc√™ pode criar uma pasta chamada `docs/` na raiz do seu projeto para guardar esses arquivos.

√â muito comum a constru√ß√£o de *vignettes* para documentar o pacote. Elas s√£o documentos em HTML melhor formatados do que a tradicional documenta√ß√£o do R.

Voc√™ pode usar a fun√ß√£o `usethis::use_vignette()` para criar *vignettes*.



---


## Boas pr√°ticas no desenvolvimento

- N√£o rode as fun√ß√µes diretamente. Utilize sempre a fun√ß√£o `devtools::load_all()`. Ela carrega todas as fun√ß√µes da pasta `R/` e as bases salvas na pasta `data/`. Isso diminuir√° a chance de elas estarem sendo afetadas por valores externos que est√£o no seu *Environment*.

- Limpe o seu *Environment* sempre que poss√≠vel. Um atalho √∫til: `CTRL+SHIFT+F10`.

- Para deixar a documenta√ß√£o das suas fun√ß√µes acess√≠vel (no help do R), use a fun√ß√£o `devtools::document()`.

- Se voc√™ precisar instalar o seu pacote (equivalente ao que fazemos com pacotes do CRAN quando rodamos `install.packages()`), use a fun√ß√£o `devtools::install()`. Ela deve ser utilizada quando o seu pacote estiver pronto (ou pelo menos alguma vers√£o dele).


---
class: middle, center
name: testes-unitarios

# Testes unit√°rios e consist√™ncia de c√≥digo


.footnote[Leia mais [neste cap√≠tulo do livro Zen do R](https://curso-r.github.io/zen-do-r/testes.html).]


---

.fazer[Escrever :) ]

.fazer[O pacote {testthat}  
`usethis::use_testthat()`
`usethis::use_test("nome_da_funcao")`

atalho: Ctrl + Shift + T (Windows e Linux) ou Cmd + Shift + T (macOS).]

.fazer[Tipos de testes

`testthat::expect_identical()`

]

Vamos falar sobre o pacote covr?  https://covr.r-lib.org/

---
class: middle, center
name: disponibilizando-o-pacote

# Disponibilizando seu pacote

---
class: middle, center, inverse
# Git e Github

---
## Git

- Git √© um **sistema de versionamento**, criado por Linus Torvalds, autor do Linux.

- √â capaz de guardar o hist√≥rico de altera√ß√µes de todos os arquivos dentro de uma pasta, que chamamos de reposit√≥rio.

- Funciona como o "*Track changes*" do word, mas muito melhor.

- Torna-se importante √† medida que seu trabalho √© __colaborativo__.

- `r colorido("Git √© um software que voc√™ instala no computador.")`

<br>

```{r echo=FALSE, out.width="30%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/git.png")
```

---
## GitHub

- GitHub √© um site onde voc√™ coloca e compartilha reposit√≥rios Git.

- Utilizado por milh√µes de pessoas em projetos de c√≥digo aberto ou fechado.

- √ötil para colaborar com outros programadores em projetos de ci√™ncia de dados.

- Existem alternativas, como [GitLab](https://about.gitlab.com/) e [BitBucket](https://bitbucket.org/product).

- `r colorido("GitHub √© um site que voc√™ acessa na internet.")`

<br>

```{r echo=FALSE, out.width="40%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/github.png")
```

---
## Pacotes e GitHub

No nosso caso, pacote e reposit√≥rio ser√£o termos equivalentes.

`r colorido("Pacotes do R e reposit√≥rios do GitHub s√£o melhores amigos.")`

```{r echo=FALSE, out.width="40%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/hug.gif")
```

<br>

O grande cupido dessa amizade √© o `{usethis}`.

---
## Fluxo de trabalho

O diagrama abaixo exemplifica o fluxo de trabalho de um projeto com versionamento.

.fazer[lembrete pra mim mesma: algumas funcoes mudaram. revisar. separar o que √© setup do que √© do fluxo de trabalho]

```{r echo=FALSE, fig.align='center', out.width="70%"}
knitr::include_graphics("img/021-organizacao-de-projetos/fluxo_github_rstudio.png")
```

---
## Passo 1: crie e configure seu pacote

```{r eval=FALSE}
usethis::create_package("meuPacote")
```

Lembrando que nomes de pacotes

- S√≥ podem ter letras, n√∫meros e ponto

- Devem come√ßar com uma letra

- N√£o podem acabar com ponto

---
## Passo 2: adicione o Git

```{r, eval=FALSE}
usethis::use_git()
```

- Rodando o comando acima na pasta do projeto (a nova aba do RStudio que
apareceu) voc√™ adiciona controle de vers√£o.

- Voc√™ receber√° algumas instru√ß√µes para seguir, mas est√° tudo certo.

---
## Passo 2¬Ω: Configure seu usu√°rio do Git

```{r eval=FALSE}
usethis::use_git_config(
  user.name = "SEU NOME NO GITHUB", 
  user.email = "seu_email_no@github.com"
)
```

- Em `user.name`, pode ser seu nome mesmo, n√£o precisa ser o nickname.

- O `user.email` precisa ser o que est√° vinculado √† sua conta do GitHub.

---
## Passo 3: Adicione o GitHub

```{r, eval=FALSE}
usethis::use_github()
```

- O comando acima sincroniza a pasta com o GitHub.

- Mais uma vez, voc√™ receber√° algumas instru√ß√µes, mas lembre-se apenas de selecionar o m√©todo de autentica√ß√£o `https`.

---
## Personal Access Token

- Ao conectar com o GitHub, voc√™ ser√° instru√≠da(o) a criar um *Personal Access Token* (PAT).


- O PAT serve para autenticar ao github, podendo ser utilizado como senha de acesso ou internamente para automatizar tarefas (como criar um reposit√≥rio).

- Para acessar seu PAT, rode `usethis::github_token()`. 

- Se quiser edit√°-lo, rode `usethis::edit_r_environ()` e lembre-se de reiniciar sua sess√£o do R.

---
## Passo 4: Stage & Commit

```{r echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/passo_3_commit_1.gif")
```

- Nesta etapa, voc√™ estar√° descrevendo as modifica√ß√µes que fez nos arquivos selecionados.

- __Observa√ß√£o__: o ato de clicar no item √© o passo de Stage.

---

## Passo 5: Push

```{r, echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/passo_4_push.gif")
```

- *Push* (ou *dar push*) significa atualizar o seu reposit√≥rio remoto (GitHub) com os arquivos que voc√™ *commitou* no passo anterior.

---

## Passo Extra: Pull

```{r, echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("img/021-organizacao-de-projetos/passo_5_pull.gif")
```

- *Pull* √© a a√ß√£o inversa do *Push*: voc√™ trar√° a vers√£o mais recente dos arquivos do seu reposit√≥rio remoto (GitHub) para a sua m√°quina (caso voc√™ tenha subido uma vers√£o de um outro computador ou uma outra pessoa tenha subido uma atualiza√ß√£o).

---

## Resumo

1. Reposit√≥rio: Criar projeto/pacote
2. Adicionar Git
3. Adicionar GitHub
4. Commit: Edite e "Commite" as mudan√ßas no c√≥digo
5. Push: Suba os commits para o Github
Extra. Pull: Baixe o estado atual do projeto

---
## Cuidados

- Se uma base de dados tem mais do que 50Mb de tamanho, ela n√£o deveria estar no seu reposit√≥rio.

- Nem sempre o comando Pull d√° certo. √Äs vezes, voc√™ e a colega de trabalho fizeram mudan√ßas no mesmo arquivo e, quando v√£o juntar, ocorre um conflito.

---

.fazer[colocar conteudo sobre Criando um {pkgdown}]

.fazer[Integra√ß√£o cont√≠nua com Github Actions]

.fazer[Regras para colocar um pacote no CRAN]




---
# Refer√™ncias  e materiais para estudo

- [Zen do R](https://curso-r.github.io/zen-do-r/), livro em desenvolvimento pela Curso-R.

- [R Packages](https://r-pkgs.org), livro aprofundado sobre desenvolvimento de pacotes.

- [R for Data Science - cap√≠tulo sobre Func√µes](https://r4ds.had.co.nz/functions.html)

- [Materiais da R-Ladies SP sobre a Hacktoberfest 2020](https://r-ladies-sao-paulo.github.io/2020-hacktoberfest/).

- [Folha de dicas do Git em Portugu√™s](https://training.github.com/downloads/pt_BR/github-git-cheat-sheet/)
